<!DOCTYPE html>
<html>
<head>
  <title>Twilio Cold Caller</title>
  <script src="https://sdk.twilio.com/js/video/releases/2.3.0/twilio-video.min.js"></script>
</head>
<body>
  <input type="text" id="toNumber" placeholder="Number to call (e.g., +15195551234)">
  <button id="callButton">Start Call</button>
  <button id="hangupButton" disabled>Hang Up</button>
  <div id="status"></div>

  <script>
    let device;
    let connection;

    // Initialize Twilio Device
    async function initializeDevice() {
      const response = await fetch('/.netlify/functions/get-token');
      const { token } = await response.json();
      
      device = new Twilio.Device(token, {
        codecPreferences: ['opus', 'pcmu'],
        logLevel: 'debug'
      });

      device.on('ready', () => {
        document.getElementById('status').textContent = 'Ready to call!';
      });

      device.on('error', (error) => {
        console.error('Device error:', error);
        document.getElementById('status').textContent = `Error: ${error.message}`;
      });

      device.on('disconnect', () => {
        document.getElementById('hangupButton').disabled = true;
        document.getElementById('callButton').disabled = false;
      });
    }

    // Start the call
    document.getElementById('callButton').addEventListener('click', async () => {
      const toNumber = document.getElementById('toNumber').value;
      document.getElementById('status').textContent = 'Calling...';
      
      const params = {
        To: toNumber,
        Agent: 'browser' // Identifier for browser-based caller
      };

      connection = await device.connect({ params });
      document.getElementById('callButton').disabled = true;
      document.getElementById('hangupButton').disabled = false;
    });

    // Hang up
    document.getElementById('hangupButton').addEventListener('click', () => {
      device.disconnectAll();
      document.getElementById('status').textContent = 'Call ended.';
    });

    initializeDevice();
  </script>
</body>
</html>
